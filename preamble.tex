% !TeX root = main.tex
%-------------------------------------------------------------------------
%	PACKAGES AND OTHER DOCUMENT CONFIGURATIONS
%-------------------------------------------------------------------------
\usepackage{mathptmx}
% Use Times New Roman as main font
\usepackage{fontspec}
\setmainfont{Times New Roman}

%-------------------------------------------------------------------------
% Table of contents and appendices setup
%-------------------------------------------------------------------------
\usepackage{tocloft}
\tocloftpagestyle{fancy}
\usepackage[toc]{appendix} % 'toc' option includes appendix chapters in ToC
\noappendicestocpagenum % Do not number the appendix page in the ToC

% Alphalph and etoolbox to have Appendix A, B, ..., Z, AA, AB, ... numbering
% https://tex.stackexchange.com/a/134046/289572
\usepackage{alphalph,etoolbox}
\appto\appendix{% patch \appendix so \AlphAlph is used
  \renewcommand\thechapter{\AlphAlph{\value{chapter}}}%
}

% Prevent that the first citation is in the ToC
\usepackage{notoccite}

\setcounter{secnumdepth}{3}
\setcounter{tocdepth}{2}

%-------------------------------------------------------------------------
% Languages setup
%-------------------------------------------------------------------------

% Language hyphenation and typographical rules
\usepackage[portuguese,english]{babel}
\setlocalecaption{english}{bib}{References}
%Custom hyphenization
\hyphenation{Py-thon}
\hyphenation{Ju-py-ter}
\hyphenation{Ma-the-ma-ti-ca}

%-------------------------------------------------------------------------
% Bibliography setup
%-------------------------------------------------------------------------

% Use biblatex with biber for references/bibliography
\AddToHook{package/biblatex/after}{%

\renewbibmacro*{doi+eprint+url}{ % redefine the macro to print DOI, eprint, URL
  \iftoggle{bbx:doi}
    {\printfield{doi}}
    {}%
  \newunit\newblock
  \iftoggle{bbx:eprint}
    {\usebibmacro{eprint}}
    {}%
  \newunit\newblock
  \iffieldundef{doi}
    {\usebibmacro{url+urldate}} % prints URL only if there is no DOI available
    {}}% closes \renewbibmacro

\renewbibmacro*{volume+number+eid}{
  \iffieldundef{volume}
    {}
    {
      \iffieldundef{number}
        {\addcomma\addspace Vol.~\printfield{volume}} % only volume
        {\addcomma\addspace Vol.~\printfield{volume}\addcomma\addspace NÂº~\printfield{number}} % both volume and number
    }
  \setunit*{\addcomma\space}
  \printfield{eid}
}

\DeclareFieldFormat % https://tex.stackexchange.com/a/509406/289572
  [article,inbook,incollection,inproceedings,patent,thesis,unpublished,book,online]
  {titlecase:title}{\MakeSentenceCase*{#1}}

\DeclareSortingNamekeyTemplate{ % from https://github.com/plk/biblatex/issues/1241#issuecomment-1210851762
    \keypart{
        \namepart[use=true]{prefix}
        \namepart{family}
    }
    \keypart{
        \namepart[inits=true]{given}
    }
    \keypart{
        \namepart{suffix}
    }
    \keypart{
        \namepart[use=false]{prefix}
    }} % closes \DeclareSortingNamekeyTemplate

\AtEveryBibitem{% clear the day and month of date field for all entries
  \clearfield{month}
  \clearfield{day}} % closes \AtEveryBibitem

\DefineBibliographyStrings{english}{%
  bibliography = {References},
}
} % closes \AddToHook

\usepackage[bibstyle=ext-authoryear,citestyle=authoryear-comp,articlein=false,dashed=fullhash,isbn=false,eprint=false,uniquename=false,uniquelist=false,giveninits=true,mincitenames=1,maxcitenames=2,maxbibnames=20]{biblatex}
\addbibresource{Bibliography.bib}

% % Use the natbib reference package - read up on this to edit the reference
% % style; if you want text (e.g. Smith et al., 2012) for the in-text references
% % (instead of numbers), remove 'numbers'
% \usepackage{natbib}
% \bibliographystyle{econ}  % Use the econ bibliography style
% % If you want to use the 'plain' style, change the above line to:
% % \bibliographystyle{plainnat}

% Include pdf pages in the document
% Necessary to include the front pages (cover and etc.)
\usepackage{pdfpages}

% Inline quotes
% added for \begin{displayquote}
\usepackage[autostyle]{csquotes}

% Interesting float placements (like 'H') and custom float types
\usepackage{float}
% Text wrapped around pictures
% https://pt.sharelatex.com/learn/Wrapping_text_around_figures
\usepackage{wrapfig}
% Force float barriers, use as \FloatBarrier
\usepackage[section]{placeins}
% Place floats *above* footnotes
\usepackage[bottom,hang,flushmargin]{footmisc}
% Set default float placement
\makeatletter
\renewcommand{\fps@figure}{tbph}
\renewcommand{\fps@table}{tbph}
\makeatother

% Pretty colours
\usepackage{xcolor}

% SVGs with Inkscape and PDF+LaTeX
% https://tex.stackexchange.com/questions/473994/svg-and-inkscape
\usepackage[inkscapearea=page]{svg}
% Specifies the directory where vector are stored
\svgpath{{Svgs/}}

% Graphics stuff
\usepackage{graphicx}  % invoked by svg
% Specifies the directory where pictures are stored
\graphicspath{{Figures/}}

% For sub-figures and stuff
\usepackage{caption}
\usepackage{subcaption}

%-------------------------------------------------------------------------
% Math stuff setup
%-------------------------------------------------------------------------
\usepackage{amsmath} % Interesting environments
\usepackage{amssymb} % Interesting symbols
\usepackage{amsthm} % Theorem environments
\usepackage{commath} % Interesting macros
\usepackage{braket} % Dirac bra-ket and set notations
\usepackage{mathtools} % Mathematical tools to use with amsmath

% Math alphabet
\DeclareMathAlphabet{\pazocal}{OMS}{zplm}{m}{n}
\newcommand{\Sa}{\pazocal{S}}
\newcommand{\Ua}{\pazocal{U}}
\newcommand{\Ha}{\pazocal{H}}
\newcommand{\Fa}{\pazocal{F}}
\newcommand{\Ia}{\pazocal{I}}
\newcommand{\Ea}{\pazocal{E}}
\newcommand{\ja}{\pazocal{J}}

%Custom math operators
\DeclareMathOperator*{\meshgrid}{meshgrid}

% Floor and ceiling of numbers
\DeclarePairedDelimiter\ceil{\lceil}{\rceil}
\DeclarePairedDelimiter\floor{\lfloor}{\rfloor}

% Notation variables
\newcommand{\dd}{\mathrm{d}}

% Units and numbers in text
\usepackage{siunitx}
\DeclareSIUnit\baud{Bd} % Baud

% Reimplementation of and extensions to LaTeX verbatim
\usepackage{verbatim} %added for \begin{comment}

% Fancy chapter start quotes
\usepackage{epigraph, varwidth}
\input{epigraphoverload}

% Use more than one optional parameter in a new commands
\usepackage{xargs}

% Hyperref and Backref
% backref makes the bibliography say where the entry was cited.
% For the print version of the thesis you might wanna set all colors to back
\usepackage{hyperref}
% \usepackage[hyperpageref]{backref}
\hypersetup{colorlinks, citecolor=black, urlcolor=black,
        linkcolor=black, breaklinks=true, hypertexnames=true}

% Interesting URL breakings
\usepackage{url}
\def\UrlBreaks{\do\/\do-\do\&\do.\do:}

% Variants of \fbox and other games with boxes
\usepackage{fancybox}

% LaTeX default text is fully-justified, but often left-justified text may be a
% more suitable format. This left-alignment can be easily accomplished by
% importing the ragged2e package.
\usepackage{ragged2e}

% Create tabular cells spanning multiple rows
\usepackage{multirow}
\usepackage{longtable} % For long tables that span multiple pages

% Changes bullet points marker
\renewcommand{\labelitemi}{\(\bullet\)}

% Notes on the documents
% https://tex.stackexchange.com/questions/9796/how-to-add-todo-notes
% https://tex.stackexchange.com/questions/316220/todo-commentsnot-include-and-left-align
% Examples:
% \unsure{Is this correct?}, \change{Change this!},
% \info{This can help me in chapter seven!}
% \improvement{This really needs to be improved!\\ What was I thinking?!}
% \thiswillnotshow{This is hidden since option `disable' is chosen!}
% WARNING: It eliminates whitespaces in front of it.
% You can add trailing {} to avoid.

\usepackage[colorinlistoftodos,
    prependcaption,
    textsize=tiny,
    textwidth=2cm]
        {todonotes}
% You can add:
% \setlength{\marginparwidth}{3cm}\reversemarginpar
% before \todo on each command for a different effect
\newcommandx{\unsure}[2][1=]{
    % \setlength{\marginparwidth}{3cm}\reversemarginpar
    \todo[linecolor=red,backgroundcolor=red!25,bordercolor=red,#1]{#2}
    }
\newcommandx{\change}[2][1=]{
    % \setlength{\marginparwidth}{3cm}\reversemarginpar
    \todo[linecolor=blue,backgroundcolor=blue!25,bordercolor=blue,#1]{#2}
    }
\newcommandx{\info}[2][1=]{
    % \setlength{\marginparwidth}{3cm}\reversemarginpar
    \todo[linecolor=green,backgroundcolor=green!25,bordercolor=green,#1]{#2}
    }
\newcommandx{\improvement}[2][1=]{
    % \setlength{\marginparwidth}{3cm}\reversemarginpar
    \todo[linecolor=yellow,backgroundcolor=yellow!25,bordercolor=yellow,#1]{#2}
    }
\newcommandx{\thiswillnotshow}[2][1=]{\todo[disable,#1]{#2}}


% \usepackage[acronym,toc,shortcuts]{glossaries}
% \makeglossaries
\usepackage{acronym} 

\usepackage{caption}
\captionsetup{justification=raggedright,singlelinecheck=false}

%-------------------------------------------------------------------------
%	Divisions' title formatting
%-------------------------------------------------------------------------
\titleformat{\subsubsection}{\fontsize{12}{0}\selectfont\bfseries}{\thesubsubsection{.}}{1em}{}
\titleformat{\subsection}{\fontsize{12}{0}\selectfont\bfseries}{\thesubsection{.}}{1em}{}
\titleformat{\section}{\fontsize{14}{0}\selectfont\bfseries}{\thesection{.}}{1em}{}
\titleformat{\chapter}[hang]{\fontsize{20}{0}\selectfont\bfseries}{\thechapter{.}}{1em}{}

\titlespacing\chapter{0pt}{12pt plus 4pt minus 2pt}{0pt plus 2pt minus 2pt}
\titlespacing\section{0pt}{12pt plus 4pt minus 2pt}{0pt plus 2pt minus 2pt}
\titlespacing\subsection{0pt}{12pt plus 4pt minus 2pt}{0pt plus 2pt minus 2pt}
\titlespacing\subsubsection{0pt}{12pt plus 4pt minus 2pt}{0pt plus 2pt minus 2pt}

% Python and MATLAB styles for code blocks
\usepackage{pythonhighlight}
\usepackage{matlab-prettifier}